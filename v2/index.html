<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iOS ìŠ¤íƒ€ì¼ ìœ„ë¡œ ë„˜ê¸°ëŠ” ì¹´ë“œë± - ê°œìˆ˜ ì œì–´</title>
<style>
body {
  background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  min-height: 100vh;
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  overflow: hidden;
  padding-top: 60px;
  box-sizing: border-box;
}

.controls {
  margin-bottom: 30px;
  display: flex;
  gap: 15px;
  align-items: center;
}

.controls button {
  padding: 8px 16px;
  border: none;
  border-radius: 12px;
  background: rgba(255,255,255,0.8);
  color: #333;
  font-weight: 500;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: all 0.2s ease;
}

.controls button:hover {
  background: rgba(255,255,255,0.95);
  transform: translateY(-1px);
}

.controls button:active {
  transform: translateY(0);
}

.controls input {
  padding: 8px 12px;
  border: 2px solid rgba(255,255,255,0.3);
  border-radius: 8px;
  background: rgba(255,255,255,0.8);
  color: #333;
  font-weight: 500;
  width: 60px;
  text-align: center;
}

.deck {
  position: relative;
  width: 700px;
  height: 1000px;
  perspective: 1200px;
}

.card {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 20px;
  background: #f8f9fa;
  box-shadow: 
    0 15px 30px rgba(0,0,0,0.06),
    0 10px 20px rgba(0,0,0,0.04),
    0 3px 8px rgba(0,0,0,0.03);
  display: flex;
  justify-content: center;
  align-items: flex-end; /* ë‚´ìš©ì„ ì•„ë˜ìª½ìœ¼ë¡œ ì´ë™ */
  padding-bottom: 20px; /* ì•„ë˜ìª½ ì—¬ë°± */
  font-size: 2em;
  font-weight: 600;
  color: #333;
  cursor: grab;
  user-select: none;
  transform-origin: center center;
  transition: box-shadow 0.3s ease;
}

.card:hover {
  box-shadow: 
    0 20px 40px rgba(0,0,0,0.08),
    0 15px 25px rgba(0,0,0,0.06),
    0 5px 12px rgba(0,0,0,0.04);
}

.card:active {
  cursor: grabbing;
}

.card-content {
  text-align: center;
}

.card-number {
  font-size: 1.2em;
  margin-bottom: 10px;
  color: #666;
}

.card-title {
  font-size: 0.8em;
  color: #999;
}

/* ğŸ“± ëª¨ë°”ì¼ ëŒ€ì‘ ê°œì„  */
@media (max-width: 768px) {
  body {
    padding-top: 40px;
  }
  
  .controls {
    margin-bottom: 20px;
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .deck {
    width: min(90vw, 400px);
    height: calc(min(90vw, 400px) * 1.4);
  }
  .card {
    font-size: 1.5em;
  }
}
</style>
</head>
<body>
<div class="controls">
  <label>ì¹´ë“œ ê°œìˆ˜: <input type="number" id="cardCount" value="6" min="1" max="20"></label>
  <button onclick="updateCardCount()">ì ìš©</button>
  <button onclick="resetCards()">ì¹´ë“œ ë¦¬ì…‹</button>
</div>

<div class="deck" id="deck">
  <!-- ì¹´ë“œëŠ” JavaScriptë¡œ ë™ì  ìƒì„± -->
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
<script>
const deck = document.querySelector(".deck");
let cards = [];
let currentDraggable = null;
let animationId = null;
let totalCardCount = 6; // ì „ì²´ ì¹´ë“œ ê°œìˆ˜
let currentCardData = []; // ì¹´ë“œ ë°ì´í„° ì €ì¥

// ì¹´ë“œ ë°ì´í„° ì´ˆê¸°í™”
function initCardData(count) {
  currentCardData = [];
  for (let i = 1; i <= count; i++) {
    currentCardData.push({
      id: i,
      title: `ì¹´ë“œ ${i}`,
      content: `ë‚´ìš© ${i}`
    });
  }
}

// ì¹´ë“œ HTML ìƒì„±
function createCard(data, index) {
  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <div class="card-content">
      <div class="card-number">Card ${data.id}</div>
      <div class="card-title">${data.title}</div>
    </div>
  `;
  return card;
}

// ì¹´ë“œ ë ˆì´ì•„ì›ƒ ë°°ì¹˜
function layoutCards() {
  const maxVisible = totalCardCount; // ëª¨ë“  ì¹´ë“œ ë³´ì´ê²Œ
  
  cards.forEach((card, i) => {
    gsap.set(card, {
      zIndex: cards.length - i,
      scale: 1 - i * 0.05,
      y: i * 80,
      opacity: i < maxVisible ? 1 : 0,
      x: 0
    });
  });
}

// ì¹´ë“œë± ì´ˆê¸°í™”
function initializeDeck(count) {
  totalCardCount = count;
  
  // ê¸°ì¡´ ì¹´ë“œ ì œê±°
  deck.innerHTML = '';
  cards = [];
  
  // ê¸°ì¡´ ë“œë˜ê·¸ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬
  if (currentDraggable) {
    currentDraggable.kill();
    currentDraggable = null;
  }
  
  // ì¹´ë“œ ë°ì´í„° ì´ˆê¸°í™”
  initCardData(count);
  
  // ì¹´ë“œ ìƒì„± ë° ì¶”ê°€
  currentCardData.forEach((data, index) => {
    const card = createCard(data, index);
    deck.appendChild(card);
    cards.push(card);
  });
  
  layoutCards();
  initTopCard();
}

// ì„±ëŠ¥ ìµœì í™”ëœ onDrag í•¨ìˆ˜
function optimizedOnDrag(draggableInstance) {
  if (animationId) return;
  
  animationId = requestAnimationFrame(() => {
    if (draggableInstance.y !== undefined) {
      const progress = Math.min(Math.abs(draggableInstance.y) / 150, 1);
      const easeProgress = easeOutCubic(progress);
      const maxVisible = totalCardCount;
      
      // ë³´ì´ëŠ” ëª¨ë“  ì¹´ë“œë“¤ì— ëŒ€í•´ ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬ (ì²« ë²ˆì§¸ ì œì™¸)
      for (let i = 1; i < Math.min(cards.length, maxVisible); i++) {
        if (cards[i]) {
          const baseY = i * 80;
          const baseScale = 1 - i * 0.05;
          const liftAmount = Math.max(40 - (i - 1) * 10, 5); // ë’¤ìª½ ì¹´ë“œì¼ìˆ˜ë¡ ì ê²Œ ì˜¬ë¼ì˜´
          const scaleBoost = Math.max(0.05 - (i - 1) * 0.01, 0.01); // ë’¤ìª½ ì¹´ë“œì¼ìˆ˜ë¡ ì‘ì€ ìŠ¤ì¼€ì¼ ë³€í™”
          
          gsap.set(cards[i], {
            y: baseY - (easeProgress * liftAmount),
            scale: baseScale + (easeProgress * scaleBoost)
          });
        }
      }
    }
    animationId = null;
  });
}

function easeOutCubic(t) {
  return 1 - Math.pow(1 - t, 3);
}

function initTopCard() {
  let topCard = cards[0];
  if (!topCard) return;
  
  // ì´ì „ ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬
  if (currentDraggable) {
    currentDraggable.kill();
    currentDraggable = null;
  }
  
  if (animationId) {
    cancelAnimationFrame(animationId);
    animationId = null;
  }
  
  currentDraggable = Draggable.create(topCard, {
    type: "y",
    inertia: true,
    onDrag() {
      optimizedOnDrag(this);
    },
    onRelease() {
      if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
      }
      
      if (this.y < -100) {
        // í–…í‹± í”¼ë“œë°±
        if (navigator.vibrate) {
          navigator.vibrate(50);
        }
        
        // ì²« ë²ˆì§¸ ì¹´ë“œ ë‚ ë¦¬ê¸°
        gsap.to(topCard, {
          y: -window.innerHeight - 50,
          opacity: 0,
          scale: 0.9,
          duration: 0.5,
          ease: "power2.in",
          onComplete: () => {
            // ì¹´ë“œë¥¼ ë§¨ ë’¤ë¡œ ì´ë™ (ìˆœí™˜)
            deck.appendChild(topCard);
            
            // cards ë°°ì—´ ì—…ë°ì´íŠ¸ - ê¸°ì¡´ ì¹´ë“œë“¤ë§Œ ìœ ì§€
            cards = Array.from(deck.querySelectorAll(".card"));
            
            // ëª¨ë“  ì¹´ë“œ ë‹¤ì‹œ ë°°ì¹˜
            layoutCards();
            
            // ìƒˆë¡œìš´ ë§¨ ì• ì¹´ë“œì— ë“œë˜ê·¸ ê¸°ëŠ¥ ì ìš©
            setTimeout(() => {
              initTopCard();
            }, 100);
          }
        });
        
        // ë‚˜ë¨¸ì§€ ì¹´ë“œë“¤ ìŠ¤í”„ë§ ì• ë‹ˆë©”ì´ì…˜
        const maxVisible = totalCardCount;
        cards.slice(1).forEach((card, i) => {
          if (i < maxVisible - 1) { // ë³´ì´ëŠ” ì¹´ë“œë“¤ë§Œ ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬
            gsap.to(card, {
              y: i * 80,
              scale: 1 - i * 0.05,
              duration: 0.6,
              ease: "back.out(1.7)",
              delay: i * 0.05
            });
          }
        });
      } else {
        // ì›ìœ„ì¹˜ - ëª¨ë“  ë³´ì´ëŠ” ì¹´ë“œë“¤ì„ ì›ë˜ ìœ„ì¹˜ë¡œ
        const maxVisible = totalCardCount;
        
        gsap.to(topCard, { 
          y: 0, 
          duration: 0.6,
          ease: "back.out(1.7)"
        });
        
        // ë‚˜ë¨¸ì§€ ë³´ì´ëŠ” ì¹´ë“œë“¤ë„ ì›ìœ„ì¹˜ë¡œ
        for (let i = 1; i < Math.min(cards.length, maxVisible); i++) {
          if (cards[i]) {
            gsap.to(cards[i], {
              y: i * 80,
              scale: 1 - i * 0.05,
              duration: 0.6,
              ease: "back.out(1.7)"
            });
          }
        }
      }
    }
  })[0];
}

// ì»¨íŠ¸ë¡¤ í•¨ìˆ˜ë“¤
function updateCardCount() {
  const input = document.getElementById('cardCount');
  const count = parseInt(input.value);
  
  if (count >= 1 && count <= 20) {
    initializeDeck(count);
  } else {
    alert('ì¹´ë“œ ê°œìˆ˜ëŠ” 1~20 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.');
    input.value = totalCardCount;
  }
}

function resetCards() {
  initializeDeck(totalCardCount);
}

// ì´ˆê¸°í™”
initializeDeck(6);

// Enter í‚¤ ì§€ì›
document.getElementById('cardCount').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    updateCardCount();
  }
});

// ë©”ëª¨ë¦¬ ì •ë¦¬
window.addEventListener('beforeunload', () => {
  if (currentDraggable) {
    currentDraggable.kill();
  }
  if (animationId) {
    cancelAnimationFrame(animationId);
  }
});
</script>
</body>
</html>
