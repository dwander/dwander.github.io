<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iOS ìŠ¤íƒ€ì¼ ìœ„ë¡œ ë„˜ê¸°ëŠ” ì¹´ë“œë± - ìŠ¤í…Œì´ë¸”1</title>
<style>
body {
  background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
  display: flex;
  justify-content: center;
  align-items: flex-start; /* ì¤‘ì•™ ì •ë ¬ ì œê±°, ìƒë‹¨ ì •ë ¬ë¡œ ë³€ê²½ */
  height: 100vh;
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  overflow: hidden;
  padding-top: 90px; /* ìƒë‹¨ 90px ê³ ì • ì—¬ë°± */
  box-sizing: border-box;
}

.deck {
  position: relative;
  width: 700px;
  height: 1000px;
  perspective: 1200px;
}

.card {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 20px;
  background: #f8f9fa; /* ë°ì€ ê·¸ë ˆì´í†¤ìœ¼ë¡œ í†µì¼ */
  box-shadow: 
    0 15px 30px rgba(0,0,0,0.06),
    0 10px 20px rgba(0,0,0,0.04),
    0 3px 8px rgba(0,0,0,0.03);
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 2em;
  font-weight: 600;
  color: #333;
  cursor: grab;
  user-select: none;
  transform-origin: center center;
  transition: box-shadow 0.3s ease;
}

.card:hover {
  box-shadow: 
    0 20px 40px rgba(0,0,0,0.08),
    0 15px 25px rgba(0,0,0,0.06),
    0 5px 12px rgba(0,0,0,0.04);
}

.card:active {
  cursor: grabbing;
}

/* ğŸ“± ëª¨ë°”ì¼ ëŒ€ì‘ ê°œì„  */
@media (max-width: 768px) {
  body {
    padding-top: 70px; /* ëª¨ë°”ì¼ì—ì„œëŠ” ì—¬ë°± ì¡°ê¸ˆ ì¤„ì„ */
  }
  
  .deck {
    width: min(90vw, 400px);
    height: calc(min(90vw, 400px) * 1.4);
  }
  .card {
    font-size: 1.5em;
  }
}
</style>
</head>
<body>
<div class="deck">
  <div class="card">1</div>
  <div class="card">2</div>
  <div class="card">3</div>
  <div class="card">4</div>
  <div class="card">5</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
<script>
const deck = document.querySelector(".deck");
let cards = Array.from(deck.querySelectorAll(".card"));
let currentDraggable = null; // í˜„ì¬ ë“œë˜ê·¸ ì¸ìŠ¤í„´ìŠ¤ ì¶”ì 
let animationId = null; // RAF ID ì¶”ì 

function layoutCards() {
  cards.forEach((card, i) => {
    gsap.set(card, {
      zIndex: cards.length - i,
      scale: 1 - i * 0.05,
      y: i * 80,
      opacity: i < 4 ? 1 : 0,
      x: 0
    });
  });
}

layoutCards();

// ì„±ëŠ¥ ìµœì í™”ëœ onDrag í•¨ìˆ˜
function optimizedOnDrag(draggableInstance) {
  // ì´ë¯¸ RAFê°€ ì˜ˆì•½ë˜ì–´ ìˆë‹¤ë©´ ìŠ¤í‚µ
  if (animationId) return;
  
  animationId = requestAnimationFrame(() => {
    // ìœ„ë¡œ ë“œë˜ê·¸ ì‹œ, ë‘ ë²ˆì§¸ ì¹´ë“œ ì‚´ì§ ì˜¬ë¼ì˜¤ê²Œ
    if (cards[1] && draggableInstance.y !== undefined) {
      const progress = Math.min(Math.abs(draggableInstance.y) / 150, 1);
      const easeProgress = easeOutCubic(progress); // ë¶€ë“œëŸ¬ìš´ easing ì ìš©
      
      // ë‘ ë²ˆì§¸ ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ (íšŒì „ íš¨ê³¼ ì œê±°)
      gsap.set(cards[1], {
        y: 80 - (easeProgress * 40),
        scale: (1 - 0.05) + (easeProgress * 0.05)
      });
      
      // ì„¸ ë²ˆì§¸ ì¹´ë“œì—ë„ ë¯¸ì„¸í•œ íš¨ê³¼ (íšŒì „ íš¨ê³¼ ì œê±°)
      if (cards[2]) {
        gsap.set(cards[2], {
          y: 160 - (easeProgress * 15),
          scale: (1 - 0.1) + (easeProgress * 0.025)
        });
      }
    }
    animationId = null; // RAF ì™„ë£Œ í›„ ID ë¦¬ì…‹
  });
}

// ë¶€ë“œëŸ¬ìš´ easing í•¨ìˆ˜
function easeOutCubic(t) {
  return 1 - Math.pow(1 - t, 3);
}

function initTopCard() {
  let topCard = cards[0];
  if (!topCard) return;
  
  // ì´ì „ Draggable ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬ (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
  if (currentDraggable) {
    currentDraggable.kill();
    currentDraggable = null;
  }
  
  // RAF IDê°€ ë‚¨ì•„ìˆë‹¤ë©´ ì·¨ì†Œ
  if (animationId) {
    cancelAnimationFrame(animationId);
    animationId = null;
  }
  
  currentDraggable = Draggable.create(topCard, {
    type: "y",
    inertia: true,
    onDrag() {
      // RAFë¥¼ ì‚¬ìš©í•œ ì„±ëŠ¥ ìµœì í™”
      optimizedOnDrag(this);
    },
    onRelease() {
      // RAF ì·¨ì†Œ (ë“œë˜ê·¸ ì™„ë£Œ ì‹œ)
      if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
      }
      
      if (this.y < -100) {
        // í–…í‹± í”¼ë“œë°± (ì§€ì›ë˜ëŠ” ë””ë°”ì´ìŠ¤ì—ì„œ)
        if (navigator.vibrate) {
          navigator.vibrate(50);
        }
        
        // ì²« ë²ˆì§¸ ì¹´ë“œ ë‚ ë¦¬ê¸° - íšŒì „ íš¨ê³¼ ì œê±°
        gsap.to(topCard, {
          y: -window.innerHeight - 50,
          opacity: 0,
          scale: 0.9,
          duration: 0.5,
          ease: "power2.in",
          onComplete: () => {
            deck.appendChild(topCard);
            cards = Array.from(deck.querySelectorAll(".card"));
            
            // ìƒˆë¡œ ì¶”ê°€ëœ ì¹´ë“œ ì •ë³´
            const newCard = cards[cards.length - 1];
            const newCardIndex = cards.length - 1;
            
            console.log('ìƒˆ ì¹´ë“œ ì¸ë±ìŠ¤:', newCardIndex); // ë””ë²„ê¹…ìš©
            
            // ë‚˜ë¨¸ì§€ ì¹´ë“œë“¤ë§Œ ë¨¼ì € ë°°ì¹˜ (ìƒˆ ì¹´ë“œ ì œì™¸)
            cards.forEach((card, i) => {
              if (card !== newCard) {
                gsap.set(card, {
                  zIndex: cards.length - i,
                  scale: 1 - i * 0.05,
                  y: i * 80,
                  opacity: i < 4 ? 1 : 0,
                  x: 0
                });
              }
            });
            
            // ìƒˆ ì¹´ë“œë§Œ ë³„ë„ ì²˜ë¦¬ - í•­ìƒ ë§ˆì§€ë§‰ ë³´ì´ëŠ” ìë¦¬(3ë²ˆ)ì— ë‚˜íƒ€ë‚¨
            const lastVisibleIndex = 3; // ë§ˆì§€ë§‰ ë³´ì´ëŠ” ì¹´ë“œ ìë¦¬
            
            if (cards.length > lastVisibleIndex) { // ì¹´ë“œê°€ 4ì¥ ì´ìƒì¼ ë•Œ
              // ìƒˆë¡œ ë³´ì´ê²Œ ë  ì¹´ë“œ ì°¾ê¸° (3ë²ˆ ìë¦¬ì— ìˆì„ ì¹´ë“œ)
              const visibleNewCard = cards[lastVisibleIndex];
              
              // ìƒˆë¡œ ë³´ì´ëŠ” ì¹´ë“œë¥¼ ìœ„ìª½ì—ì„œ ì‹œì‘
              gsap.set(visibleNewCard, {
                zIndex: cards.length - lastVisibleIndex,
                scale: 1 - lastVisibleIndex * 0.05,
                y: lastVisibleIndex * 80 - 100, // 3ë²ˆ ìë¦¬ ìœ„ìª½ì—ì„œ ì‹œì‘
                opacity: 1,
                x: 0
              });
              
              console.log('ìƒˆ ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ (3ë²ˆ ìë¦¬)'); // ë””ë²„ê¹…ìš©
              
              // ì²œì²œíˆ 3ë²ˆ ìë¦¬ë¡œ ë‚´ë ¤ì˜¤ê¸°
              gsap.to(visibleNewCard, {
                y: lastVisibleIndex * 80, // 3ë²ˆ ìë¦¬
                duration: 0.8,
                ease: "power2.out",
                onComplete: () => {
                  console.log('ìƒˆ ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ'); // ë””ë²„ê¹…ìš©
                  initTopCard();
                }
              });
            } else {
              // ì¹´ë“œê°€ 4ì¥ ë¯¸ë§Œì¸ ê²½ìš°ì—ë„ ì¦‰ì‹œ ë‹¤ìŒ ë“œë˜ê·¸ ì¤€ë¹„
              initTopCard();
            }
          }
        });
        
        // ë‚˜ë¨¸ì§€ ì¹´ë“œë“¤ì˜ ìŠ¤í”„ë§ ì• ë‹ˆë©”ì´ì…˜ (íšŒì „ íš¨ê³¼ ì œê±°)
        cards.slice(1).forEach((card, i) => {
          if (i < 3) { // ë³´ì´ëŠ” ì¹´ë“œë“¤ë§Œ
            gsap.to(card, {
              y: i * 80,
              scale: 1 - i * 0.05,
              duration: 0.6,
              ease: "back.out(1.7)",
              delay: i * 0.05 // ì•½ê°„ì˜ ì§€ì—°ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ íš¨ê³¼
            });
          }
        });
      } else {
        // ì›ìœ„ì¹˜ - íšŒì „ íš¨ê³¼ ì œê±°
        gsap.to(topCard, { 
          y: 0, 
          duration: 0.6,
          ease: "back.out(1.7)"
        });
        
        if (cards[1]) {
          gsap.to(cards[1], {
            y: 80,
            scale: 1 - 0.05,
            duration: 0.6,
            ease: "back.out(1.7)"
          });
        }
        
        if (cards[2]) {
          gsap.to(cards[2], {
            y: 160,
            scale: 1 - 0.1,
            duration: 0.6,
            ease: "back.out(1.7)"
          });
        }
      }
    }
  })[0]; // ë°°ì—´ì—ì„œ ì²« ë²ˆì§¸ ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸°
}

initTopCard();

// í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ë©”ëª¨ë¦¬ ì •ë¦¬
window.addEventListener('beforeunload', () => {
  if (currentDraggable) {
    currentDraggable.kill();
  }
  if (animationId) {
    cancelAnimationFrame(animationId);
  }
});
</script>
</body>
</html>
